<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel of Fortune</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Wheel of Fortune</h1>
        <div class="balance">
            Баланс токена SepoliaETH: <span id="wallet-balance">0 SepoliaETH</span>
        </div>
        <div class="wallet-address">
            Номер кошелька: <span id="wallet-address"></span>
        </div>
        <div class="apikey-input">
            API ключ Etherscan: <input type="text" id="apikey-input">
        </div>
        <div class="betting">
            <label>
                Сумма ставки:
                <input type="number" id="bet-amount" required>
            </label>
            <label>
                Значение ставки:
                <input type="number" id="bet-value" required>
            </label>
        </div>
        <div class="options">
            <label>
                <input type="radio" name="wheel-options" value="4" checked> 4 Values
            </label>
            <label>
                <input type="radio" name="wheel-options" value="6"> 6 Values
            </label>
            <label>
                <input type="radio" name="wheel-options" value="8"> 8 Values
            </label>
            <label>
                <input type="radio" name="wheel-options" value="16"> 16 Values
            </label>
        </div>
        <div class="wheel-container">
            <div id="chart"></div>
            <div class="pointer"></div>
        </div>
        <div id="result"></div>
    </div>

    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const walletBalanceSpan = document.getElementById('wallet-balance');
            const walletAddressSpan = document.getElementById('wallet-address');
            const apiKeyInput = document.getElementById('apikey-input');

            let userAddress = ''; // Адрес пользователя из MetaMask

            // Функция для получения адреса пользователя из MetaMask
            async function getUserAddress() {
                if (window.ethereum) {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAddress = accounts[0];
                    walletAddressSpan.innerText = userAddress;
                    updateWalletBalance();
                } else {
                    walletAddressSpan.innerText = 'MetaMask не обнаружен';
                }
            }

            // Функция для обновления баланса токена
            async function updateWalletBalance() {
                const apiKey = apiKeyInput.value; // Получаем API ключ из поля ввода

                const tokenContractAddress = 'адрес контракта SepoliaETH';
                const tokenDecimals = 18; // Количество десятичных знаков для SepoliaETH

                const apiUrl = `https://api.etherscan.io/api?module=account&action=tokenbalance&contractaddress=${tokenContractAddress}&address=${userAddress}&tag=latest&apikey=${apiKey}`;

                try {
                    const response = await fetch(apiUrl);
                    const data = await response.json();

                    if (data.status === '1') {
                        const balance = parseFloat(data.result) / (10 ** tokenDecimals); // Преобразование баланса к формату с учетом десятичных знаков
                        walletBalanceSpan.innerText = `${balance} SepoliaETH`;
                    } else {
                        throw new Error('Ошибка получения баланса токена.');
                    }
                } catch (error) {
                    console.error(error);
                    walletBalanceSpan.innerText = 'Ошибка получения баланса токена.';
                }
            }

            // Обработчик события изменения API ключа
            apiKeyInput.addEventListener('change', updateWalletBalance);

            // Получаем адрес пользователя из MetaMask
            getUserAddress();
        });
    </script>
</body>
</html>
